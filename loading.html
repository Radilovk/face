<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>Анализът се извършва...</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyan: '#2dd4bf',
                        teal: '#14b8a6',
                        black: '#0f172a'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="flex flex-col items-center text-center">
        <img id="loader-gif" class="w-36 h-36 rounded-xl" src="assets/ChatGPT%20Image%20Jul%205,%202025,%2008_22_22%20PM.png" alt="Analyzing...">
        <h1 class="text-xl mt-8">Вашият анализ се генерира</h1>
        <p id="loading-text" class="text-cyan-500 h-8">Инициализиране...</p>
    </div>
    <script>
        // Анимация на текста
        const texts = [
            "Сканиране на изображението...",
            "Анализ на дермалната структура...",
            "Проверка за маркери на възпаление...",
            "Извличане на препоръки...",
            "Финализиране на доклада..."
        ];
        let i = 0;
        const loadingTextElement = document.getElementById('loading-text');
        const interval = setInterval(() => {
            if(loadingTextElement) loadingTextElement.textContent = texts[i];
            i = (i + 1) % texts.length;
        }, 2500);

        // Fetch логика (същата като преди)
        (async () => {
            const workerUrl = 'https://face.radilov-k.workers.dev/';
            try {
                const payloadString = sessionStorage.getItem('analysisPayload');
                if (!payloadString) throw new Error("Липсват данни за анализ.");
                const response = await fetch(workerUrl, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: payloadString,
                });
                if (!response.ok) throw new Error(`Грешка от сървъра: ${await response.text()}`);
                const results = await response.json();
                sessionStorage.setItem('analysisResult', JSON.stringify(results));
                window.location.href = 'results.html';
            } catch (error) {
                alert(`Възникна грешка: ${error.message}`);
                window.location.href = 'index.html';
            }
        })();
    </script>
    <script src="js/theme.js"></script>
</body>
</html>

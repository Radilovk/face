<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>Анализът се извършва...</title>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyan: '#06b6d4',
                        teal: '#14b8a6',
                        black: '#000'
                    },
                    fontFamily: {
                        orbitron: ["'Orbitron'", 'sans-serif'],
                        poppins: ["'Poppins'", 'sans-serif']
                    }
                }
            }
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="font-poppins bg-gray-100 flex items-center justify-center min-h-screen text-gray-800">
    <div class="flex flex-col items-center text-center space-y-4">
        <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
        <div class="w-64 h-2 bg-gray-200 rounded overflow-hidden">
            <div id="progress-bar" class="h-2 bg-cyan-500 w-0"></div>
        </div>
        <h1 class="text-lg font-semibold">Вашият анализ се генерира</h1>
        <p id="loading-text" class="h-6">Инициализиране...</p>
    </div>
    <script>
        // Анимация на текста
        const texts = [
            "Сканиране на изображението...",
            "Анализ на дермалната структура...",
            "Проверка за маркери на възпаление...",
            "Извличане на препоръки...",
            "Финализиране на доклада..."
        ];
        let i = 0;
        const loadingTextElement = document.getElementById('loading-text');
        const progressBar = document.getElementById('progress-bar');
        let prog = 0;
        const interval = setInterval(() => {
            if(loadingTextElement) loadingTextElement.textContent = texts[i];
            i = (i + 1) % texts.length;
            prog = (prog + 5) % 100;
            if(progressBar) progressBar.style.width = prog + '%';
        }, 500);

        // Fetch логика (същата като преди)
        (async () => {
            const workerUrl = 'https://face.radilov-k.workers.dev/';
            try {
                const payloadString = sessionStorage.getItem('analysisPayload');
                if (!payloadString) throw new Error("Липсват данни за анализ.");
                const response = await fetch(workerUrl, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: payloadString,
                });
                if (!response.ok) throw new Error(`Грешка от сървъра: ${await response.text()}`);
                const results = await response.json();
                sessionStorage.setItem('analysisResult', JSON.stringify(results));
                if(progressBar) progressBar.style.width = '100%';
                clearInterval(interval);
                window.location.href = 'results.html';
            } catch (error) {
                clearInterval(interval);
                alert(`Възникна грешка: ${error.message}`);
                window.location.href = 'index.html';
            }
        })();
    </script>
    <script src="js/theme.js"></script>
</body>
</html>

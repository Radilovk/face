<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>Анализът се извършва...</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="loading-body">
    <div class="loading-container">
        <img id="loader-gif" src="assets/dna.gif" alt="Analyzing...">
        <h1>Вашият анализ се генерира</h1>
        <p id="loading-text">Инициализиране...</p>
    </div>
    <script>
        // Анимация на текста
        const texts = [
            "Сканиране на изображението...",
            "Анализ на дермалната структура...",
            "Проверка за маркери на възпаление...",
            "Извличане на препоръки...",
            "Финализиране на доклада..."
        ];
        let i = 0;
        const loadingTextElement = document.getElementById('loading-text');
        const interval = setInterval(() => {
            if(loadingTextElement) loadingTextElement.textContent = texts[i];
            i = (i + 1) % texts.length;
        }, 2500);

        // Fetch логика (същата като преди)
        (async () => {
            const workerUrl = 'https://face.radilov-k.workers.dev/';
            try {
                const payloadString = sessionStorage.getItem('analysisPayload');
                if (!payloadString) throw new Error("Липсват данни за анализ.");
                const response = await fetch(workerUrl, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: payloadString,
                });
                if (!response.ok) throw new Error(`Грешка от сървъра: ${await response.text()}`);
                const results = await response.json();
                sessionStorage.setItem('analysisResult', JSON.stringify(results));
                window.location.href = 'results.html';
            } catch (error) {
                alert(`Възникна грешка: ${error.message}`);
                window.location.href = 'index.html';
            }
        })();
    </script>
</body>
</html>

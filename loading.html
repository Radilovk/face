<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>Анализът се извършва...</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="loading-body">
    <div class="loading-container">
        <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
        <div class="progress-bar-wrapper w-64 mt-4">
            <div id="progress-bar" class="progress-bar"></div>
        </div>
        <h1>Вашият анализ се генерира</h1>
        <p id="loading-text">Инициализиране...</p>
    </div>
    <script>
        // Анимация на текста
        const texts = [
            "Сканиране на изображението...",
            "Анализ на дермалната структура...",
            "Проверка за маркери на възпаление...",
            "Извличане на препоръки...",
            "Финализиране на доклада..."
        ];
        let i = 0;
        const loadingTextElement = document.getElementById('loading-text');
        const progressBar = document.getElementById('progress-bar');
        let prog = 0;
        const interval = setInterval(() => {
            if(loadingTextElement) loadingTextElement.textContent = texts[i];
            i = (i + 1) % texts.length;
            prog = (prog + 5) % 100;
            if(progressBar) progressBar.style.width = prog + '%';
        }, 500);

        // Fetch логика (същата като преди)
        (async () => {
            const workerUrl = 'https://face.radilov-k.workers.dev/';
            try {
                const payloadString = sessionStorage.getItem('analysisPayload');
                if (!payloadString) throw new Error("Липсват данни за анализ.");
                const response = await fetch(workerUrl, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: payloadString,
                });
                if (!response.ok) throw new Error(`Грешка от сървъра: ${await response.text()}`);
                const results = await response.json();
                sessionStorage.setItem('analysisResult', JSON.stringify(results));
                if(progressBar) progressBar.style.width = '100%';
                clearInterval(interval);
                window.location.href = 'results.html';
            } catch (error) {
                clearInterval(interval);
                alert(`Възникна грешка: ${error.message}`);
                window.location.href = 'index.html';
            }
        })();
    </script>
    <script src="js/theme.js"></script>
</body>
</html>
